Name:         motion
Version:      @VERSION@
Release:      1
License:      GPL
Summary:      MOTION, a Video-surveilance-system
Group:        Applications/Multimedia
ExclusiveOS:  Linux
Source0:      http://prdownloads.sourceforge.net/%{name}/%{name}-%{version}.tar.gz
URL:          http://motion.sourceforge.net/
Packager:     Kenneth Lavrsen <kenneth@lavrsen.dk>
BuildRoot:    %{_tmppath}/%{name}-%{version}-root

%description
Motion is a software motion detector. It grabs images from
video4linux devices and/or from webcams (such as the axis network
cameras). Motion is the perfect tool for keeping an eye on your
property keeping only those images that are interesting. Motion is
strictly command line driven and can run as a daemon with a rather
small footprint. It is built with MySQL and PostgreSQL support and
mpegs generated by ffmpeg and http remote control.

%prep
%setup

%build
%configure --sysconfdir=%{_sysconfdir}/%{name} --without-optimizecpu --without-libjpeg-mmx
make 

%install
rm -rf $RPM_BUILD_ROOT
install -d  %{buildroot}%{_sysconfdir}/%{name}
install -d  %{buildroot}%{_sysconfdir}/init.d

%makeinstall
if [ -f %{buildroot}%{_sysconfdir}/motion-dist.conf ] ; then mv %{buildroot}%{_sysconfdir}/motion-dist.conf %{buildroot}%{_sysconfdir}/%{name}/. ; fi
mv %{buildroot}%{_datadir}/doc/%{name}-%{version}/examples/motion.init-RH %{buildroot}%{_sysconfdir}/init.d/%{name}-temp
sed  -e 's/MOTION-\/usr\//MOTION-/g' \
%{buildroot}%{_sysconfdir}/init.d/%{name}-temp > %{buildroot}%{_sysconfdir}/init.d/%{name}
rm %{buildroot}%{_sysconfdir}/init.d/%{name}-temp
chmod +x  %{buildroot}%{_sysconfdir}/init.d/%{name}
%clean
rm -rf $RPM_BUILD_ROOT

%files
%attr (-,root,root)
%dir %{_sysconfdir}/%{name}
%dir %{_sysconfdir}/init.d/*
%config %{_sysconfdir}/%{name}/*
%doc CHANGELOG COPYING CREDITS INSTALL README motion_guide.html
%doc motion-dist.conf thread1.conf thread2.conf thread3.conf thread4.conf
%{_bindir}/*
%{_mandir}/man?/*

